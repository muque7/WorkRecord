# 2020-06-17 web页面请求过程

总结请求www.google.com的过程（计算机网络自上而下第七版p326）

### 1.准备：获得自己的IP地址值

DHCP、UDP、IP和以太网

##### 1.动态主机配置协议（DHCP）

###### 作用：

当一台主机接入网络时，需要为其自动分配IP地址

##### 2.无类别域间路由选择（CIDR）

###### 作用

因特网地址的分配策略

##### 3..分配IP过程

###### DHCP服务器发现

使用**DHCP发现报文**

客户在**UDP**分组中向端口67发送该报文

由于新主机没有IP地址，也没有DHCP服务器的地址，所以使用广播目的地址255.255.255.255和“本主机”源地址0.0.0.0。主机将该IP数据报传递给链路层，链路层将该帧广播到所有与该子网连接的节点。

###### DHCP服务器提供

当DHCP服务器接收到DHCP发现报文时，使用**CIDR**分配地址，用**DHCP提供报文**向顾客做出响应，仍然使用广播目的地址（为什么？）

###### DHCP请求

新到达的客户从一个或多个服务器提供中选一个，并向选中的服务器提供**DHCP请求报文**响应，该报文中包含服务器标识字段（选择的DHCP服务器IP），其他服务器将其识别为拒绝

###### DHCP ACK

服务器通过**DHCP ACK报文**对DHCP请求报文响应（响应方式是广播吗?），该ACK中包含，生成的IP地址，DNS服务器的IP地址，默认网关路由器的IP地址，和子网块（等价于网络掩码）

### 2.仍在准备：获得目的地IP地址值

DNS，ARP

##### 1.DNS协议

提供将域名转换为IP地址值的服务

##### 2.ARP协议

地址解析协议

提供将网络层地址值（如IP地址值）转换为链路层地址值（如MAC地址值）

##### 3.从DNS获取目的地IP地址值过程

###### DNS查询报文

将域名地址放入该报文

该报文防止在具有53号端口的UDP报文段中

该UDP报文段则被放入具有DNS的IP地址(包含在DHCP ACK报文中)和源IP地址的 IP数据报中

将该IP数据包放入一个以太网帧，通过链路层寻址，找到网关路由器（此时只知道网关路由器的IP地址值，需要转换为MAC地址值）

###### 将网关路由器IP地址值转换为MAC地址值

主机生成一个包含网关路由器IP地址的ARP查询报文

将该报文放置在一个具有广播目的地址（FF:FF:FF:FF:FF:FF）的以太网帧中

向交换器发送该以太网帧

交换器将此帧交付给所有连接的设备，包括网关路由器

网关路由器接收到该ARP查询报文，并发现匹配其接口的IP地址

则发送ARP回答报文

将ARP回答报文放入一个以太网帧，目的MAC地址为主机的MAC地址值

向交换机发送此帧，在由交换器交付给主机

主机则获得网关路由器的MAC地址值

###### 从域内路由选择到DNS

主机获得网关路由器的MAC地址值后

将之前准备的以太网帧通过交换器交付给网关路由器

网关路由器收取该帧，抽取IP数据报，检查目的地址，转发到目标网络的路由器

该路由器接收到该帧，抽取IP数据，检查目的地址，根据**转发表**确定出接口，经过该接口向DNS服务器转发数据报（该转发表根据**域内协议**以及**因特网的域间协议BGP**填写）

最终该IP数据报到达DNS服务器，DNS服务器找到www.google.com对应的IP地址值

DNS服务器形成回答报文

该报文被放入UDP报文段中，再被放到包含主机IP的IP数据报中，通过沿途网络和路由器，交换机反向转发到主机

### 3.Web客户-服务器交互

TCP，HTTP，HTTPS

###### 三次握手

###### 四次挥手