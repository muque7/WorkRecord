### 2020-07-21【新增sql】 学妹2根据包名查询对应充值金额

学妹2做一个sql，能根据包名查询对应充值金额。

学妹2上新unity包之后，能根据新旧包的包名，查询对应储值金额。

功能与目前储值管理-充值统计功能一样，多一个筛选包名的功能即可。

功能最晚上线截止时间在本周四。

![image-20200721162656697](2020-07-21【新增sql】 学妹2根据包名查询对应充值金额.assets/image-20200721162656697.png)

```sql
找出使用超过两个包的玩家
SELECT
  device_id,
  COUNT(DISTINCT(package_name)) AS num
FROM
  girlsh5_ods.pf_device_list
WHERE
  timestamp>='1970-01-01 00:00:00+0:00'
GROUP BY
  device_id
HAVING
  num>=2
```

```sql
找出使用超过两个包的玩家的记录
SELECT
  device_id,
  package_name,
  MIN(timestamp)
FROM
  girlsh5_ods.pf_device_list
WHERE
  timestamp>='1970-01-01 00:00:00+0:00'
  AND device_id IN (
  SELECT
    device_id
  FROM
    girlsh5_ods.pf_device_list
  WHERE
    timestamp>='1970-01-01 00:00:00+0:00'
  GROUP BY
    device_id
  HAVING
    COUNT(DISTINCT(package_name))>=2)
GROUP BY
  device_id,
  package_name
```

```sql
找出现在正在使用新包的人数
SELECT
  device_id,
  package_name,
FROM
  girlsh5_pf.v_device_list
WHERE
  package_name='com.moemoe.battle'
  AND create_time>='2020-01-01 00:00:00+0:00'

```

