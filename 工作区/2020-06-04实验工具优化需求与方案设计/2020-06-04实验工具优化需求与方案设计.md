### 实验工具优化需求与方案设计 2020-06-04

##### 相关需求

###### 1.

创建实验时新增：根据特定IP指定实验测试账号

与通过id指定实验测试账号互斥

？控制粒度：对一个IP是否进行划分实验组

​		由于同时可能有多个运营or策划在通过公司IP登陆，因此需要后端处理为“在指定IP下登陆的，按照登陆先后顺序来分配实验组”。

实时生效

test_players中途修改会影响之前的测试账号吗

###### 2.

增加实验类型参数

实验类型：长期实验，短期实验

创建实验后，不支持中途更改实验方案，要修改只能撤销重新生成

###### 3.

实验结束，回传增加实验类型参数



###### 接口改动

```
{
    "unique_key": "3kg5a",    //分流标识符，详见分流算法的说明
    "deviding_rule": {
        "bucket_sum": 100,    //流量固定分为100份，以便进行灰度调整
        "groups": [
            {
                "group_key": "A",    //实验变体的标识符
                "ratio": 40     //该变体所占流量百分比
            },
            {
                "group_key": "B",
                "ratio": 30
            },
            {
                "group_key": "C",
                "ratio": 30
            }
        ]
    },
    "tracking_event": {    //实验追踪的标志事件，需记录至log_event表
        "event_type": "experiment",    //固定，因为log_event表中还有newer_guide等事件
        "event_name": "3kg5a_000"    //由salt拼接而来，以确保唯一性
    },
    "player_filter":{    //参与实验的用户筛选条件
        "create_time": [1555718400,1558195200], //角色创建时间的范围，值为unix时间戳
        "server_id": [100,101,102],    //服务器id，数组
        "attribute_lang": ["en","fr"]    //玩家语言
        //暂无其他筛选条件，之后视需求添加
    },
    "test_players": [
        {"player_id":1000546879, "group_key":"A"},
        {"player_id":1000945775, "group_key":"B"},
        {"player_id":1000547934, "group_key":"C"}
    ],
    "final_group_key": "A"    //实验结束时确定的最终使用的组别
    
    //新增字段
    "experiment_type": "long_term_experiment"  //short_term_experiment
    
    //修改字段
    "test_players": [
        {"player_id":1000546879, "group_key":"A"},
        //互斥
        {"player_ip":1000546879, "group_key":"A"}
    ]
}
```

